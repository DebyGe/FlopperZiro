#include <Wire.h>
#include <Adafruit_SSD1306.h>
#include <Adafruit_GFX.h>
#include <Adafruit_PN532.h>

#define IRQ   (8)
#define RESET (9)

int buttonUp= 2;   
int buttonDown = 3;
int buttonLeft = 4;   
int buttonSelect = 6; 
int currentPage = 0;
int scelta=0;
const int numPages = 5; 

//tamaguino
const int sound = 0;
const int button1Pin = 4;
const int button2Pin = 3; 
const int button3Pin = 6; 
int button1State = 0;
int button2State = 0;
int button3State = 0;
#define ACTIVATED LOW

const unsigned char flopperblocked[] PROGMEM = {
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0xff, 0xf3, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0xff, 0xf3, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0xff, 0xf3, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0xc0, 0x03, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0x80, 0x03, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0x80, 0x03, 0x87, 0xe0, 0xe3, 0xe0, 0xe3, 0xe0, 0x1f, 0xf3, 0xbe, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0xc0, 0x03, 0x87, 0xe0, 0xe3, 0xe0, 0xe3, 0xe0, 0x1f, 0xf3, 0xbe, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0xfe, 0x03, 0x87, 0xe0, 0xe3, 0xe0, 0xe3, 0xe0, 0x1f, 0xf3, 0xff, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0xfe, 0x03, 0xb8, 0x1c, 0xfc, 0x1c, 0xfc, 0x1c, 0xe0, 0x73, 0xc1, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0xfe, 0x03, 0xb8, 0x1c, 0xfc, 0x1c, 0xfc, 0x1c, 0xe0, 0xf3, 0xc1, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0x80, 0x03, 0xb8, 0x1c, 0xfc, 0x1c, 0xfc, 0x1c, 0xff, 0xf3, 0x80, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0x80, 0x03, 0xb8, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c, 0xff, 0x83, 0x80, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0x80, 0x03, 0xb8, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c, 0xff, 0x83, 0x80, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0x80, 0x03, 0xb8, 0x1c, 0xe0, 0x1c, 0xe0, 0x1c, 0xe0, 0x03, 0x80, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0x80, 0x03, 0xb8, 0x1c, 0xff, 0xe0, 0xff, 0xe0, 0xe0, 0x73, 0x80, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0x80, 0x03, 0xb8, 0x1c, 0xff, 0xe0, 0xff, 0xe0, 0xe0, 0x73, 0x80, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0x80, 0x03, 0x87, 0xe0, 0xff, 0xe0, 0xff, 0xe0, 0x1f, 0xf3, 0x80, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0x80, 0x03, 0x87, 0xe0, 0xf0, 0x00, 0xf0, 0x00, 0x1f, 0xf3, 0x80, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0x80, 0x03, 0x87, 0xe0, 0xe0, 0x00, 0xe0, 0x00, 0x1f, 0xf3, 0x80, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x00, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x00, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x00, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x00, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x00, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0xff, 0xfd, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0xff, 0xfd, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x83, 0xff, 0xfd, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x1d, 0xce, 0xf8, 0x1f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x00, 0x01, 0xce, 0xf8, 0x1f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x01, 0xc1, 0xcf, 0xfc, 0x1f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x01, 0xc1, 0xcf, 0x04, 0xe0, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x01, 0xc1, 0xcf, 0x04, 0xe0, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x0e, 0x01, 0xce, 0x00, 0xe0, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x0e, 0x01, 0xce, 0x00, 0xe0, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x0e, 0x01, 0xce, 0x00, 0xe0, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x70, 0x01, 0xce, 0x00, 0xe0, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0x80, 0x70, 0x01, 0xce, 0x00, 0xe0, 0x70, 0x00, 0x00, 0x01, 0x81, 0x80, 0x00, 0x60, 0x00, 0x19, 
  0x80, 0x70, 0x01, 0xce, 0x00, 0xe0, 0x70, 0x00, 0x00, 0x01, 0x81, 0x80, 0x00, 0x62, 0x00, 0x19, 
  0x83, 0xff, 0xfd, 0xce, 0x00, 0x1f, 0x80, 0x00, 0x00, 0x01, 0x81, 0x8e, 0x1c, 0x66, 0x7c, 0xf9, 
  0x83, 0xff, 0xfd, 0xce, 0x00, 0x1f, 0x80, 0x00, 0x00, 0x01, 0xb9, 0x9e, 0x3e, 0x6c, 0x7c, 0xf9, 
  0x83, 0xff, 0xfd, 0xce, 0x00, 0x1f, 0x80, 0x00, 0x00, 0x01, 0xff, 0xf3, 0xe3, 0x78, 0xff, 0x99, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc7, 0xf3, 0xe1, 0x70, 0xfd, 0x99, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x87, 0xf3, 0xe3, 0x68, 0xc1, 0x99, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x87, 0xf3, 0xe3, 0x6c, 0xcf, 0x99, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xf9, 0x9e, 0x3e, 0x66, 0x7f, 0xf9, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xf8, 0x8c, 0x1c, 0x42, 0x3d, 0xf9, 
  0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
};

int buf[]={115,232,15,186};
bool tag=false;

Adafruit_PN532 nfc(IRQ, RESET);
Adafruit_SSD1306 display(128, 64);

void setup() {
  Serial.begin(9600);
  Wire.begin();

  //setup button
  pinMode(buttonUp, INPUT_PULLUP);
  pinMode(buttonDown, INPUT_PULLUP);
  pinMode(buttonLeft, INPUT_PULLUP);
  pinMode(buttonSelect, INPUT_PULLUP);

  //setup tamaguino
  pinMode(button1Pin, INPUT_PULLUP);
  pinMode(button2Pin, INPUT_PULLUP);
  pinMode(button3Pin, INPUT_PULLUP);
  pinMode(sound, OUTPUT);

  randomSeed(analogRead(0));

  //setup display 
  display.begin(SSD1306_SWITCHCAPVCC, 0x3C);
  display.clearDisplay();
  display.setTextColor(WHITE);
  display.clearDisplay();
  display.drawBitmap(0, 0, flopperblocked, 128, 64, WHITE);
  display.display(); 

  //Setup rfid/nfc
  nfc.begin();
  uint32_t versiondata = nfc.getFirmwareVersion();
  if (! versiondata) {
    Serial.print("Didn't find PN53x board");
    while (1);
  }
  nfc.SAMConfig();

 
}



void loop() {
  switch(scelta){
    case 0:
      displayMenu();
      break;
    case 1:
      graficausb();
      badusb();
      break;
    case 2:
      graficarfid();
      rfid();
      break;
    default:
      currentPage=0;
      scelta=0;
      break;
  }
  delay(150);
}
